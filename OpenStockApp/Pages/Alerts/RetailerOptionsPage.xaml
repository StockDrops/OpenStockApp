<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:mct="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             xmlns:users="clr-namespace:OpenStockApi.Core.Models.Users;assembly=OpenStockApi.Core"
             xmlns:views="clr-namespace:OpenStockApp.Views"
             x:Class="OpenStockApp.Pages.Alerts.RetailerOptionsPage"
             x:Name="page"
             Title="Retailer Options"
             >
    <ContentPage.Resources>
        <mct:BoolToObjectConverter x:Key="BoolToObjectConverter" TrueObject="Busy... Please wait..." FalseObject="Save Alert Settings" />
        <mct:InvertedBoolConverter x:Key="InvertedBoolConverter" />
        <mct:EnumToIntConverter x:Key="EnumToIntConverter" />
    </ContentPage.Resources>
    <ContentPage.Behaviors>
        <mct:EventToCommandBehavior
            EventName="Appearing"
            Command="{Binding OnNavigatedToCommand}" />
    </ContentPage.Behaviors>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="{OnPlatform Android=40, Default=80}" />
        </Grid.RowDefinitions>
        <StackLayout Grid.Row="0" Margin="{OnPlatform iOS='30,60,30,30', Android='5', Default='30'}" IsVisible="{Binding IsLoggedIn}" >
            <Grid HeightRequest="40">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="{OnPlatform UWP='0.3*', Default='0.6*'}"/>
                    <ColumnDefinition Width="0.4*"/>
                </Grid.ColumnDefinitions>
                <StackLayout Grid.Row="0" Grid.Column="0" Orientation="Horizontal">
                    <Label VerticalOptions="Center" Text="Retailer Options" Style="{StaticResource ListTitleStyle}"
                               Margin="0,10,0,10"/>
                    <Button Text="Help" IsVisible="{OnPlatform Android='False', UWP='True', Default='False'}" 
                                Command="{Binding DisplayHelp, Source={x:Reference page}}" 
                                HeightRequest="40"
                                Margin="10,10,0,10"/>
                </StackLayout>

                <Button Text="Help" 
                        IsVisible="{OnPlatform Android='True', UWP='False', Default='True'}"
                        Command="{Binding DisplayHelp, Source={x:Reference page}}" 
                        HeightRequest="40" 
                        HorizontalOptions="{OnPlatform Android='End', UWP='End', Default='End'}" 
                        Grid.Column="{OnPlatform Default=1, UWP=0}"/>
            </Grid>
            
            <!--<Grid HeightRequest="40">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="0.6*"/>
                    <ColumnDefinition Width="0.4*"/>
                </Grid.ColumnDefinitions>

                <Label VerticalOptions="End" Text="Retailer Options" Style="{StaticResource ListTitleStyle}" Margin="0,10,0,10"/>
                <Button Text="Help" Command="{Binding DisplayHelp, Source={x:Reference page}}" HeightRequest="40" HorizontalOptions="End" Grid.Column="1"/>
            </Grid>-->

            <Picker Title="Select a country"
                        ItemsSource="{Binding Countries}"
                        ItemDisplayBinding="{Binding Name}"
                        SelectedItem="{Binding SelectedCountry}"
                        
                        >
                <Picker.Behaviors>
                    <mct:EventToCommandBehavior EventName="SelectedIndexChanged" Command="{Binding LoadRetailers}"/>
                </Picker.Behaviors>

            </Picker>

            <CollectionView ItemsSource="{Binding Retailers}"
                            ItemsUpdatingScrollMode="KeepScrollOffset"
                            
                            Margin="0,10,0,10"
                            >
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="users:RetailerOptions">
                        <Grid HeightRequest="90"
                                HorizontalOptions="Start"
                                  
                            WidthRequest="100"
                                Margin="10,0,10,0">
                            <StackLayout>
                                <Label Text="{Binding Retailer.Name}" Style="{StaticResource ListTitleStyle}" />
                                <StackLayout Orientation="Horizontal">
                                    <Label Text="Enable" VerticalOptions="Center" Margin="5" />
                                    <Switch IsToggled="{Binding IsEnabled}" VerticalOptions="Center"  Margin="5"/>
                                </StackLayout>
                                <!--<Picker SelectedItem="{Binding ModelOptions.NotificationAction}" />-->
                            </StackLayout>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </StackLayout>
        <views:LogInView IsLoggedIn="{Binding IsLoggedIn}"
                            LogInCommand="{Binding LogIn}"
                         Grid.Row="0"
                         Grid.RowSpan="2"/>
        <Button  Text="{Binding IsBusy, Converter={StaticResource BoolToObjectConverter}}"
                Command="{Binding SaveModelOptions}" 
                IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                 IsVisible="{Binding IsLoggedIn}"
                Grid.Row="1"/>
    </Grid>
</ContentPage>